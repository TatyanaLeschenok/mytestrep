general:
  build_dir: MyApplication
  branches:
    only:
    - master
machine:
  pre:
    - brew install Caskroom/cask/java
    - brew install maven
    - brew install node
    - npm install -g appium  # get appium
    - npm install wd
  post:
    - appium -p 4723 -a 127.0.0.1:
        background: true
    - sleep 5
dependencies:
  pre:
  - npm install -g appium  # get appium
  - npm install wd
  - appium -p 4723 -a 127.0.0.1
  - android list sdk
  - echo y | android update sdk --no-ui --all --filter 'extra,131'
  - chmod +x gradlew
  - ./gradlew clean
  #- ./gradlew tasks --all
#test:
#  override:
#    - appium -p 4723 -a 127.0.0.1
#    - mvn test
  post:
  - ./gradlew jacocoTestReport
  - cp -r app/build/test-results/* $CIRCLE_TEST_REPORTS
  - cp -r app/build/reports/jacoco/jacocoTestReport/* $CIRCLE_ARTIFACTS 
deployment:
  master:
    branch: master
    commands:
      - ./deploy_master.sh
