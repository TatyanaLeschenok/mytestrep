general:
  build_dir: MyApplication
  branches:
    only:
    - master
machine:
  environment:
    APP_VERSION_CODE: "11"
    APP_VERSION_NAME: "0.11.0"
dependencies:
  pre:
  - chmod +x gradlew
  - ./gradlew clean
  #- ./gradlew tasks --all
  post:
  - wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
  - tar -xzf sc-latest-linux.tar.gz
test:
  override:
  - ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY -f ~/sc_ready:
    background: true
    pwd: sc-*-linux
  #Wait for tunnel to be ready
  - while [ ! -e ~/sc_ready ]; do sleep 1; done
  post:
  - ./gradlew jacocoTestReport
  - cp -r app/build/test-results/* $CIRCLE_TEST_REPORTS
  - cp -r app/build/reports/jacoco/jacocoTestReport/* $CIRCLE_ARTIFACTS 
deployment:
  master:
    branch: master
    commands:
      - ./deploy_master.sh
