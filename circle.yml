general:
  build_dir: MyApplication
  branches:
    only:
    - master
machine:
  pre:
    - >
      if [ -n "${RUN_NIGHTLY_BUILD}" ]; then
      sh mytestrep/MyApplication/install_appium.sh;
      fi
  post:
    - >
      if [ -n "${RUN_NIGHTLY_BUILD}" ]; then
      sh mytestrep/MyApplication/run_appium.sh;
      fi
      
checkout:
  post:
     - >
      if [ -n "${RUN_NIGHTLY_BUILD}" ]; then
      git clone git@github.com:rs/SDWebImage.git;
      fi
dependencies:
  post:
    - appium -p 4723 -a 127.0.0.1:
        background: true
    - sleep 5
  # pre:
  # - npm install -g appium  # get appium
  # - npm install wd
  # - appium -p 4723 -a 127.0.0.1
  # - android list sdk
  # - echo y | android update sdk --no-ui --all --filter 'extra,131'
  # - chmod +x gradlew
  # - ./gradlew clean
  #- ./gradlew tasks --all
#test:
#  override:
#    - appium -p 4723 -a 127.0.0.1
#    - mvn test
  post:
  - ./gradlew jacocoTestReport
  - cp -r app/build/test-results/* $CIRCLE_TEST_REPORTS
  - cp -r app/build/reports/jacoco/jacocoTestReport/* $CIRCLE_ARTIFACTS 
deployment:
  master:
    branch: master
    commands:
      - ./deploy_master.sh
